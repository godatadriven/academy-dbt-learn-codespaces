## Exercise: Creating an Aggregated Fact Table

In this exercise, you will create an **aggregated fact table** from the `fct_shipments` table. 
The goal is to summarize key metrics for each **shipment type** and **business**, such as the total shipment weight, 
total revenue, and the number of shipments. This aggregated fact will help provide a high-level overview of shipment 
performance for analysis purposes.

### Create a new dbt Model for Aggregated Fact

- Create a new file in your `models` directory called `agg_fct_shipments.sql`.
- In this file, write a SQL query that will aggregate the data from the `fct_shipments` table by `shipment_type_id` and `business_id`.
- The query should:
- Group by `shipment_type_id` and `business_id`.
- Aggregate the following fields:
    - Sum of `wgtKg_123X` to get the total shipment weight.
    - Sum of `price_per_kg * wgtKg_123X` to get the total revenue.
    - Count the number of `shipment_id` to get the number of shipments.

### Run the dbt models and validate the results
- Once the model is created, run the model using the following command:
    ```bash
    dbt run --models agg_fct_shipments
    ```
- After running the model, ensure that the output makes sense. Check for basic anomalies, such as unexpected zeros or null values in your aggregated metrics.

### Expected Outcome:
- A new aggregated fact table is created, summarizing shipment data by **shipment type** and **business**.
- The table includes the following columns:
  - `shipment_type_id`: The identifier for the shipment type (regular or express).
  - `business_id`: The identifier for the business responsible for the shipment.
  - `total_weight`: The total weight of shipments for that shipment type and business.
  - `total_revenue`: The total revenue generated by shipments for that shipment type and business.
  - `num_shipments`: The total number of shipments for that shipment type and business.
  

### Key Concepts Covered:
- **Aggregated Fact Tables**: Summarizing transactional data for faster analysis.
- **SQL Grouping and Aggregation**: Using `GROUP BY`, `SUM()`, `COUNT()`, and `AVG()` for summarizing large datasets.
- **DBT Models**: Building and running dbt models to transform raw data into meaningful, analytical datasets.

By the end of this exercise, you have an aggregated fact table that provides important 
business and shipment-level metrics, making it easier for analysts to derive insights from the data.